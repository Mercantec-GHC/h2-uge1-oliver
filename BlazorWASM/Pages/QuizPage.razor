@page "/quiz"
@using BlazorWASM.Models
@inject BlazorWASM.Services.APIService ApiService

<h3>Trivia Quiz</h3>

@if (questions == null)
{
    <p>Indlæser spørgsmål...</p>
}
else if (currentQuestionIndex >= questions.Count)
{
    <h4>Quiz færdig!</h4>
    <p>Du fik @score point ud af @questions.Count.</p>
    <button @onclick="RestartQuiz">Start igen</button>
}
else
{
    <div>
        <p><strong>Spørgsmål @(@currentQuestionIndex + 1):</strong> @((MarkupString)questions[currentQuestionIndex].Question)</p>

        @foreach (var answer in questions[currentQuestionIndex].Incorrect_Answers)
        {
            <button @onclick="() => CheckAnswer(answer)" disabled="@(answered)">@((MarkupString)answer)</button>
        }

        @if (answered)
        {
            <p>@(isCorrect ? "✅ Rigtigt!" : "❌ Forkert! Korrekt svar var: " + questions[currentQuestionIndex].Correct_Answer)</p>
            <button @onclick="NextQuestion">Næste spørgsmål</button>
        }
    </div>
}

@code {
    private List<TriviaQuestion> questions;
    private int currentQuestionIndex = 0;
    private int score = 0;
    private bool answered = false;
    private bool isCorrect = false;

    protected override async Task OnInitializedAsync()
    {
        questions = await ApiService.GetTriviaQuestionsAsync();
    }

    private void CheckAnswer(string selectedAnswer)
    {
        answered = true;
        isCorrect = selectedAnswer == questions[currentQuestionIndex].Correct_Answer;
        if (isCorrect) score++;
    }

    private void NextQuestion()
    {
        currentQuestionIndex++;
        answered = false;
        isCorrect = false;
    }

    private async Task RestartQuiz()
    {
        currentQuestionIndex = 0;
        score = 0;
        answered = false;
        questions = await ApiService.GetTriviaQuestionsAsync();
    }
}
